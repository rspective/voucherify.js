{"version":3,"sources":["voucherify.js"],"names":["window","Voucherify","document","$","buildAPI","baseUrl","validate","redeem","publish","list","track","validatePromotion","isValidResponseStructure","data","object","roundMoney","value","Math","round","validatePercentDiscount","discount","Error","validateAmountDiscount","validateUnitDiscount","isValidInit","options","applicationId","console","error","renderIframes","RenderIframe","element","self","this","_element","_path","path","_options","helpers","readOptions","common_attributes","concat","customer_attributes","attributes","defaults","_iframe","renderIframe","host","consent_fields","iframes_widgets","voucher-redeem","height","get-voucher","subscribe","bind","name","callback","addEventListener","attachEvent","allowed_options","Array","prototype","reduce","call","allowed_option","option_value","getAttribute","encodeOptions","query_parameters","Object","keys","forEach","option_key","push","encodeURIComponent","join","widget_height","undefined","css_props","createElement","setAttribute","style","cssText","visibility","src","appendChild","widgets","widget_name","elements","querySelectorAll","API","OPTIONS","INVALID_AMOUNT","INVALID_NUMBER","MISSING_AMOUNT","INVALID_CUSTOMER_PHONE","EMAIL_PATTERN","xhrImplementation","Deferred","method","url","payload","deferred","resolve","reject","ajax","type","JSON","stringify","xhrFields","withCredentials","dataType","headers","Accept","Content-Type","X-Client-Application-Id","X-Client-Token","token","X-Voucherify-Channel","timeout","success","message","context","promise","request","XMLHttpRequest","open","setRequestHeader","onload","status","parse","responseText","onerror","send","voucherify","initialize","clientAppId","setIdentity","trackingId","setBaseUrl","indexOf","code","amount","items","metadata","orderMetadata","customer","isPromotion","replace","queryString","parseInt","map","item","index","key","metadataKey","source_id","campaign","channel","listVouchers","filters","param","event_name","event","utils","calculatePrice","basePrice","voucher","unitPrice","e","gift","min","balance","percent_off","priceDiscount","amount_limit","amount_off","newPrice","unit_off","calculateDiscount","render","selector","getCapitalizedName","charAt","toUpperCase","slice","getPropertyName","prefix","getConfigProperty","create$control","$container","config","$control","configured$control","configurable","length","append","attribute","hasOwnProperty","attr","text","addClass","$element","$logoContainer","$code","logoSrc","placeholder","textPlaceholder","$amount","amountPlaceholder","$discountType","$percentOff","$amountOff","$unitOff","$tracking","$validate","textValidate","classInvalid","classValid","classInvalidAnimation","classValidAnimation","on","toggleClass","val","delay","queue","dequeue","parseFloat","response","valid","setFieldInvalid","$field","responseJSON","error_key","hide","tracking_id","prop","onValidated","renderRedeem","$redeem","textRedeem","order","result","onRedeem","renderPublish","contains","arr","some","field","containsCustomer","customerFields","isRequired","find","required","error$control","campaignName","$customerName","customerNamePlaceholder","$row1","$customerEmail","customerEmailPlaceholder","$customerPhone","customerPhonePlaceholder","$customerLine1","customerLine1Placeholder","$customerLine2","customerLine2Placeholder","$row3","$customerPostalCode","customerPostalCodePlaceholder","$customerCity","customerCityPlaceholder","$row4","$customerState","customerStatePlaceholder","$customerCountry","customerCountryPlaceholder","$publishStatus","$publish","textPublish","test","show","onPublished","refreshIframes","docReady","info","funcName","baseObj","ready","readyFired","i","readyList","fn","ctx","readyStateChange","readyState","readyEventHandlersInstalled","TypeError","setTimeout","module","exports","jQuery"],"mappings":"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","file":"voucherify.min.js","sourcesContent":["window.Voucherify = (function (window, document, $) {\n  \"use strict\";\n\n  var API = buildAPI(\"https://api.voucherify.io\");\n\n  function buildAPI(baseUrl) {\n    return {\n      validate:          baseUrl + \"/client/v1/validate\",\n      redeem:            baseUrl + \"/client/v1/redeem\",\n      publish:           baseUrl + \"/client/v1/publish\",\n      list:              baseUrl + \"/client/v1/vouchers\",\n      track:             baseUrl + \"/client/v1/events\",\n      validatePromotion: baseUrl + \"/client/v1/promotions/validation\"\n    };\n  }\n\n  var OPTIONS = {};\n\n  // Error keys returned from voucherify API\n  var INVALID_AMOUNT = \"invalid_amount\";\n  var INVALID_NUMBER = \"invalid_number\";\n  var MISSING_AMOUNT = \"missing_amount\";\n  var INVALID_CUSTOMER_PHONE = \"invalid_customer_phone\";\n\n  var EMAIL_PATTERN = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n\n  function isValidResponseStructure(data) {\n    return data && (typeof(data.valid) === \"boolean\" // validate\n       || typeof(data.result) === \"string\" // redeem\n       || typeof(data.voucher) === \"object\" // publish\n       || typeof(data.vouchers) === \"object\" // list\n       || (data.object === \"event\" && typeof(data.type) === \"string\") // track\n    );\n  }\n\n  var xhrImplementation = null;\n\n  if ($ && typeof($.ajax) === \"function\" && $.Deferred) {\n    xhrImplementation = function (method, url, payload, callback) {\n      var deferred = typeof(callback) === \"function\" ? { resolve: callback, reject: callback } : $.Deferred();\n\n      $.ajax({\n        type: method,\n\n        url: url,\n\n        data: JSON.stringify(payload),\n\n        xhrFields: {\n          withCredentials: true\n        },\n\n        dataType: \"json\",\n        headers: {\n          \"Accept\": \"application/json\",\n          \"Content-Type\": \"application/json\",\n          \"X-Client-Application-Id\": OPTIONS.applicationId,\n          \"X-Client-Token\": OPTIONS.token,\n          \"X-Voucherify-Channel\": \"Voucherify.js\"\n        },\n        timeout: OPTIONS.timeout,\n\n        success: function (data) {\n          if (isValidResponseStructure(data)) {\n            deferred.resolve(data);\n            return;\n          }\n\n          deferred.reject({\n            type: \"error\",\n            message: \"Unexpected response structure.\",\n            context: data\n          });\n        },\n\n        error: function (error) {\n          deferred.reject({\n            type: \"error\",\n            message: \"XHR error happened.\",\n            context: error\n          });\n        }\n      });\n\n      if (typeof(callback) !== \"function\") {\n        return deferred.promise();\n      }\n    };\n  } else {\n    xhrImplementation = function (method, url, payload, callback) {\n      callback = typeof(callback) === \"function\" ? callback : function () {\n      };\n\n      var request = new window.XMLHttpRequest();\n\n      request.withCredentials = true;\n      request.open(method, url, true);\n      request.timeout = OPTIONS.timeout;\n\n      request.setRequestHeader(\"Accept\", \"application/json\");\n      request.setRequestHeader(\"Content-Type\", \"application/json\");\n      request.setRequestHeader(\"X-Client-Application-Id\", OPTIONS.applicationId);\n      request.setRequestHeader(\"X-Client-Token\", OPTIONS.token);\n      request.setRequestHeader(\"X-Voucherify-Channel\", \"Voucherify.js\");\n\n      request.onload = function () {\n        if (request.status >= 200 && request.status < 400) {\n          try {\n            var data = JSON.parse(request.responseText);\n\n            if (isValidResponseStructure(data)) {\n              callback(data);\n              return;\n            }\n\n            callback({\n              type: \"error\",\n              message: \"Unexpected response structure.\",\n              context: data\n            });\n          } catch (error) {\n            callback({\n              type: \"error\",\n              message: \"Unparsable response.\",\n              context: error\n            });\n          }\n        } else {\n          callback({\n            type: \"error\",\n            message: \"Unexpected status code.\",\n            context: request.status\n          });\n        }\n      };\n\n      request.onerror = function (error) {\n        callback({\n          type: \"error\",\n          message: \"XHR error happened.\",\n          context: error\n        });\n      };\n\n      request.send(JSON.stringify(payload));\n    };\n  }\n\n  function roundMoney(value) {\n    return Math.round(value * (100 + 0.001)) / 100;\n  }\n\n  function validatePercentDiscount(discount) {\n    if (!discount || discount < 0 || discount > 100) {\n      throw new Error(\"Invalid voucher, percent discount should be between 0-100.\");\n    }\n  }\n\n  function validateAmountDiscount(discount) {\n    if (!discount || discount < 0) {\n      throw new Error(\"Invalid voucher, amount discount must be higher than zero.\");\n    }\n  }\n\n  function validateUnitDiscount(discount) {\n    if (!discount || discount < 0) {\n      throw new Error(\"Invalid voucher, unit discount must be higher than zero.\");\n    }\n  }\n\n  function isValidInit(options) {\n    if (!options.applicationId) {\n      console.error(\"Voucherify.js ERROR: Missing Client Application ID.\");\n      return false;\n    }\n    if (!options.applicationId) {\n      console.error(\"Voucherify.js ERROR: Missing Client Token (Secret Key).\");\n      return false;\n    }\n    return true;\n  }\n\n  var voucherify = {\n    initialize: function (clientAppId, token, timeout) {\n      OPTIONS.applicationId = clientAppId;\n      OPTIONS.token = token;\n      OPTIONS.timeout = timeout || 5000;\n    },\n\n    setIdentity: function (trackingId) {\n      OPTIONS.trackingId = trackingId;\n    },\n\n    setBaseUrl: function (baseUrl) {\n      baseUrl = baseUrl || \"\";\n\n      if (baseUrl.indexOf(\"https://\") !== 0 && baseUrl.indexOf(\"http://\") !== 0) {\n        baseUrl = \"https://\" + baseUrl;\n      }\n\n      API = buildAPI(baseUrl);\n    },\n\n    validate: function (code, callback) {\n      if (!isValidInit(OPTIONS)) {\n        return null;\n      }\n\n      var isPromotion = false;\n      var amount;\n      var items;\n      var metadata;\n      var orderMetadata;\n      var customer;\n\n      if (typeof(code) === \"object\") {\n        amount = code.amount;\n        items = code.items;\n        metadata = code.metadata;\n        orderMetadata = code.orderMetadata;\n        customer = code.customer;\n        code = code.code;\n      }\n\n      if (!!code) {\n        code = code.replace(/[\\s\\r\\n]/g, \"\");\n      }\n\n      var queryString = \"?\";\n      if (!code) {\n        isPromotion = true;\n        if (amount) {\n          queryString += \"amount=\" + parseInt(amount);\n        }\n      } else {\n        queryString += \"code=\" + encodeURIComponent(code);\n        if (amount) {\n          queryString += \"&amount=\" + parseInt(amount); // in cents, amount=1000 means $10\n        }\n      }\n\n      if (items) {\n        queryString += \"&\" + items.map(function (item, index) {\n          return Object.keys(item).map(function (key) {\n            return encodeURIComponent(\"item[\" + index + \"][\" + key + \"]\") + \"=\" + encodeURIComponent(item[key]);\n          }).join(\"&\");\n        }).join(\"&\");\n      }\n\n      if (metadata) {\n        queryString += \"&\" + Object.keys(metadata).map(function (key) {\n          return encodeURIComponent(\"metadata[\" + key + \"]\") + \"=\" + encodeURIComponent(metadata[key]);\n        }).join(\"&\");\n      }\n\n      if (orderMetadata) {\n        queryString += \"&\" + Object.keys(orderMetadata).map(function (key) {\n          return encodeURIComponent(\"order[metadata][\" + key + \"]\") + \"=\" + encodeURIComponent(orderMetadata[key]);\n        }).join(\"&\");\n      }\n\n      if (customer) {\n        if (typeof(customer) !== \"object\") {\n          console.error(\"Customer must be an object - please use instead { source_id: 'your_user' }\");\n          return null;\n        }\n\n        queryString += \"&\" + Object.keys(customer).map(function (key) {\n          if (key === \"metadata\") {\n            if (typeof(customer.metadata) !== \"object\") {\n              console.error(\"Customer's metadata must be an object - please use instead { property: 'value' }\");\n              return null;\n            }\n\n            return Object.keys(customer.metadata).map(function (metadataKey) {\n              return encodeURIComponent(\"customer[metadata][\" + metadataKey + \"]\") + \"=\" + encodeURIComponent(customer.metadata[metadataKey]);\n            }).join(\"&\");\n          }\n\n          return encodeURIComponent(\"customer[\" + key + \"]\") + \"=\" + encodeURIComponent(customer[key]);\n        }).join(\"&\");\n      }\n\n      if (OPTIONS.trackingId) {\n        queryString += \"&tracking_id=\" + encodeURIComponent(OPTIONS.trackingId);\n      }\n\n      return xhrImplementation(\"GET\", (isPromotion ? API.validatePromotion : API.validate) + queryString, undefined, callback);\n    },\n\n    redeem: function (code, payload, callback) {\n      if (!isValidInit(OPTIONS)) {\n        return null;\n      }\n\n      if (!code) {\n        console.error(\"Voucherify client could not verify code, because it is missing - please provide Voucher Code.\");\n        return null;\n      }\n\n      var queryString = \"?code=\" + encodeURIComponent(code.replace(/[\\s\\r\\n]/g, \"\"));\n\n      // -- Tracking ID fallback\n      payload = payload || {};\n      payload.customer = payload.customer || {};\n      payload.customer.source_id = payload.customer.source_id || OPTIONS.trackingId;\n\n      return xhrImplementation(\"POST\", API.redeem + queryString, payload, callback);\n    },\n\n    publish: function (campaign, payload, callback) {\n      if (!isValidInit(OPTIONS)) {\n        return null;\n      }\n\n      if (!campaign) {\n        console.error(\"Voucherify.js ERROR: campaign is required to publish a voucher.\");\n        return null;\n      }\n\n      var queryString = \"?campaign=\" + encodeURIComponent(campaign);\n\n      // -- Tracking ID fallback\n      payload = payload || {};\n      payload.customer = payload.customer || {};\n      payload.customer.source_id = payload.customer.source_id || OPTIONS.trackingId;\n      // -- Default channel\n      payload.channel = payload.channel || \"Voucherify.js\";\n\n      return xhrImplementation(\"POST\", API.publish + queryString, payload, callback);\n    },\n\n    listVouchers: function (filters, callback) {\n      if (!isValidInit(OPTIONS)) {\n        return null;\n      }\n\n      if (typeof filters === \"function\" && !callback) {\n        callback = filters;\n        filters = {};\n      }\n\n      var queryString = \"?\" + $.param(filters);\n\n      return xhrImplementation(\"GET\", API.list + queryString, undefined, callback);\n    },\n\n    track: function (event_name, metadata, customer, callback) {\n      if (!isValidInit(OPTIONS)) {\n        return null;\n      }\n\n      if (typeof customer === \"function\" && !callback) {\n        callback = customer;\n        customer = {};\n      }\n\n      var payload = {};\n      payload.event = event_name;\n      payload.metadata = metadata;\n      payload.customer = payload.customer || customer || {};\n      payload.customer.source_id = payload.customer.source_id || OPTIONS.trackingId;\n\n      return xhrImplementation(\"POST\", API.track, payload, callback);\n    },\n\n    utils: {\n      calculatePrice: function (basePrice, voucher, unitPrice) {\n        var e = 100; // Number of digits after the decimal separator.\n        var discount;\n\n        if (voucher.gift) {\n          discount = Math.min(voucher.gift.balance / e, basePrice);\n          return roundMoney(basePrice - discount);\n        }\n\n        if (!voucher.discount) {\n          throw new Error(\"Unsupported voucher type.\");\n        }\n\n        if (voucher.discount.type === 'PERCENT') {\n          discount = voucher.discount.percent_off;\n          validatePercentDiscount(discount);\n          var priceDiscount = basePrice * (discount / 100);\n\n          if (voucher.discount.amount_limit) {\n            priceDiscount = Math.min(voucher.discount.amount_limit / e, priceDiscount);\n          }\n\n          return roundMoney(basePrice - priceDiscount);\n\n        } else if (voucher.discount.type === 'AMOUNT') {\n          discount = voucher.discount.amount_off / e;\n          validateAmountDiscount(discount);\n          var newPrice = basePrice - discount;\n          return roundMoney(newPrice > 0 ? newPrice : 0);\n\n        } else if (voucher.discount.type === 'UNIT') {\n          discount = voucher.discount.unit_off;\n          validateUnitDiscount(discount);\n          var newPrice = basePrice - unitPrice * discount;\n          return roundMoney(newPrice > 0 ? newPrice : 0);\n\n        } else {\n          throw new Error(\"Unsupported discount type.\");\n        }\n      },\n\n      calculateDiscount: function (basePrice, voucher, unitPrice) {\n        var e = 100; // Number of digits after the decimal separator.\n        var discount;\n\n        if (voucher.gift) {\n          discount = Math.min(voucher.gift.balance / e, basePrice);\n          return roundMoney(discount);\n        }\n\n        if (!voucher.discount) {\n          throw new Error(\"Unsupported voucher type.\");\n        }\n\n        if (voucher.discount.type === 'PERCENT') {\n          discount = voucher.discount.percent_off;\n          validatePercentDiscount(discount);\n          var priceDiscount = basePrice * (discount / e);\n\n          if (voucher.discount.amount_limit) {\n            priceDiscount = Math.min(voucher.discount.amount_limit / e, priceDiscount);\n          }\n\n          return roundMoney(priceDiscount);\n        } else if (voucher.discount.type === 'AMOUNT') {\n          discount = voucher.discount.amount_off / e;\n          validateAmountDiscount(discount);\n          var newPrice = basePrice - discount;\n          return roundMoney(newPrice > 0 ? discount : basePrice);\n\n        } else if (voucher.discount.type === 'UNIT') {\n          discount = voucher.discount.unit_off;\n          validateUnitDiscount(discount);\n          var priceDiscount = unitPrice * discount;\n          return roundMoney(priceDiscount > basePrice ? basePrice : priceDiscount);\n\n        } else {\n          throw new Error(\"Unsupported discount type.\");\n        }\n      }\n    },\n    render: function (selector, options) {\n      var $element = $(selector);\n      if (!$element || !$element.length) {\n        throw new Error(\"Element '\" + selector + \"' cannot be found\");\n      }\n      options = options || {};\n\n      function getCapitalizedName(name) {\n        return name.charAt(0).toUpperCase() + name.slice(1);\n      }\n\n      function getPropertyName(prefix, name) {\n        return prefix + getCapitalizedName(name);\n      }\n\n      function getConfigProperty(prefix, name) {\n        return options[getPropertyName(prefix, name)];\n      }\n\n      function create$control(type, name, $container, config) {\n        config = config || {};\n        var $control = null;\n        var configured$control = getConfigProperty(\"selector\", name);\n\n        if (config.configurable && configured$control) {\n          $control = $(configured$control);\n        }\n\n        if (!$control || !$control.length) {\n          $control = $(document.createElement(type));\n          $container.append($control);\n\n          for (var attribute in config) {\n            if (attribute !== \"configurable\" && config.hasOwnProperty(attribute)) {\n              $control.attr(attribute, config[attribute]);\n            }\n          }\n\n          if (type === \"input\") {\n            $control.attr(\"name\", getPropertyName(\"voucherify\", name));\n          }\n\n          if (type === \"span\" && config.text) {\n            $control.text(config.text);\n          }\n        }\n\n        $control.addClass(typeof getConfigProperty(\"class\", name) === \"string\" ? getConfigProperty(\"class\", name) : getPropertyName(\"voucherify\", name));\n        return $control;\n      }\n\n      var $container     = create$control(\"div\", \"container\", $element);\n      var $logoContainer = create$control(\"figure\", \"logo\", $container);\n      var $logo          = create$control(\"img\", \"logo\", $logoContainer, { src: typeof options.logoSrc === \"string\" ? options.logoSrc : \"https://app.voucherify.io/images/favicon.png\" });\n      var $code          = create$control(\"input\", \"code\", $container, { type: \"text\", placeholder: typeof options.textPlaceholder === \"string\" ? options.textPlaceholder : \"e.g. abc-123\" });\n      var $amount        = create$control(\"input\", \"amount\", $container, { type: options.amount ? \"text\" : \"hidden\", placeholder: typeof options.amountPlaceholder === \"string\" ? options.amountPlaceholder : \"e.g. 52.22\" });\n      var $discountType  = create$control(\"input\", \"discountType\", $container, { type: \"hidden\", configurable: true });\n      var $percentOff    = create$control(\"input\", \"percentOff\", $container, { type: \"hidden\", configurable: true });\n      var $amountOff     = create$control(\"input\", \"amountOff\", $container, { type: \"hidden\", configurable: true });\n      var $unitOff       = create$control(\"input\", \"unitOff\", $container, { type: \"hidden\", configurable: true });\n      var $tracking      = create$control(\"input\", \"tracking\", $container, { type: \"hidden\", configurable: true });\n      var $validate      = create$control(\"button\", \"validate\", $container, {});\n      var $validateText  = create$control(\"span\", \"validateText\", $validate, { text: typeof options.textValidate === \"string\" ? options.textValidate : \"Validate\" });\n\n      var self = this;\n      var classInvalid = options.classInvalid === \"string\" ? options.classInvalid : \"voucherifyInvalid\";\n      var classValid = typeof options.classValid === \"string\" ? options.classValid : \"voucherifyValid\";\n      var classInvalidAnimation = options.classInvalidAnimation === \"string\" ? options.classInvalidAnimation : \"voucherifyAnimationShake\";\n      var classValidAnimation = options.classValidAnimation === \"string\" ? options.classValidAnimation : \"voucherifyAnimationTada\";\n\n      $code.on(\"keyup\", function (event) {\n        $code.toggleClass(classInvalidAnimation, false);\n      });\n\n      $amount.on(\"keyup\", function (event) {\n        $amount.toggleClass(classInvalidAnimation, false);\n      });\n\n      $validate.on(\"click\", function (event) {\n        $discountType.val(\"\");\n        $amountOff.val(\"\");\n        $unitOff.val(\"\");\n        $percentOff.val(\"\");\n        $tracking.val(\"\");\n\n        $validate.toggleClass(classInvalid, false);\n        $validate.toggleClass(classValid, false);\n\n        if (!$code.val()) {\n          $code.toggleClass(classInvalidAnimation, true)\n            .delay(1000)\n            .queue(function () {\n              $code.toggleClass(classInvalidAnimation, false);\n              $code.dequeue();\n            });\n          return;\n        }\n\n        var payload = {\n          code: $code.val(),\n          amount: parseInt(parseFloat($amount.val().replace(/\\,/, \".\")) * 100)\n        };\n\n        self.validate(payload, function (response) {\n          if (!response || !response.valid) {\n\n            var setFieldInvalid = function ($field) {\n              $field.toggleClass(classInvalid, true);\n              $field.toggleClass(classValid, false);\n              $field.toggleClass(classInvalidAnimation, true)\n              .delay(1000)\n              .queue(function(){\n                $field.toggleClass(classInvalidAnimation, false);\n                $field.dequeue();\n              });\n            };\n\n            $validate.toggleClass(classInvalid, true);\n            $validate.toggleClass(classValid, false);\n\n            var context      = response.context || {};\n            var responseJSON = context.responseJSON || {};\n            var error_key    = responseJSON.key;\n\n            if (options.amount && (\n                error_key === INVALID_AMOUNT ||\n                error_key === INVALID_NUMBER ||\n                error_key === MISSING_AMOUNT)) {\n              setFieldInvalid($amount);\n            } else {\n              setFieldInvalid($code);\n            }\n            return;\n          }\n\n          if ($amount.val() >= 0) {\n            $amount.val(parseFloat($amount.val().replace(/\\,/, \".\")));\n          } else {\n            $amount.hide(100);\n          }\n\n          $code.toggleClass(classInvalid, false);\n          $amount.toggleClass(classInvalid, false);\n          $discountType.val(response.discount && response.discount.type || \"\");\n          $amountOff.val(response.discount && response.discount.amount_off || 0);\n          $unitOff.val(response.discount && response.discount.unit_off || 0);\n          $percentOff.val(response.discount && response.discount.percent_off || 0);\n          $tracking.val(response.tracking_id || \"\");\n\n          $code.prop(\"disabled\", true);\n          $amount.prop(\"disabled\", true);\n          $validate.prop(\"disabled\", true);\n\n          $code.toggleClass(classValid, true);\n          $amount.toggleClass(classValid, true);\n          $validate.toggleClass(classValid, true);\n          $validate.toggleClass(classInvalid, false);\n          $code.toggleClass(classInvalid, false);\n\n          $code.toggleClass(classValidAnimation, true);\n          $amount.toggleClass(classValidAnimation, true);\n\n          if (options && options.onValidated && typeof options.onValidated === \"function\") {\n            options.onValidated(response);\n          }\n        });\n      });\n    },\n\n    renderRedeem: function (selector, options) {\n      var $element = $(selector);\n      if (!$element || !$element.length) {\n        throw new Error(\"Element '\" + selector + \"' cannot be found\");\n      }\n      options = options || {};\n\n      function getCapitalizedName(name) {\n        return name.charAt(0).toUpperCase() + name.slice(1);\n      }\n\n      function getPropertyName(prefix, name) {\n        return prefix + getCapitalizedName(name);\n      }\n\n      function getConfigProperty(prefix, name) {\n        return options[getPropertyName(prefix, name)];\n      }\n\n      function create$control(type, name, $container, config) {\n        config = config || {};\n        var $control = null;\n        var configured$control = getConfigProperty(\"selector\", name);\n\n        if (config.configurable && configured$control) {\n          $control = $(configured$control);\n        }\n\n        if (!$control || !$control.length) {\n          $control = $(document.createElement(type));\n          $container.append($control);\n\n          for (var attribute in config) {\n            if (attribute !== \"configurable\" && config.hasOwnProperty(attribute)) {\n              $control.attr(attribute, config[attribute]);\n            }\n          }\n\n          if (type === \"input\") {\n            $control.attr(\"name\", getPropertyName(\"voucherify\", name));\n          }\n\n          if (type === \"span\" && config.text) {\n            $control.text(config.text);\n          }\n        }\n\n        $control.addClass(typeof getConfigProperty(\"class\", name) === \"string\" ? getConfigProperty(\"class\", name) : getPropertyName(\"voucherify\", name));\n        return $control;\n      }\n\n      var $container     = create$control(\"div\", \"container\", $element);\n      var $logoContainer = create$control(\"figure\", \"logo\", $container);\n      var $logo          = create$control(\"img\", \"logo\", $logoContainer, { src: typeof options.logoSrc === \"string\" ? options.logoSrc : \"https://app.voucherify.io/images/favicon.png\" });\n      var $code          = create$control(\"input\", \"code\", $container, { type: \"text\", placeholder: typeof options.textPlaceholder === \"string\" ? options.textPlaceholder : \"e.g. abc-123\" });\n      var $amount        = create$control(\"input\", \"amount\", $container, { type: options.amount ? \"text\" : \"hidden\", placeholder: typeof options.amountPlaceholder === \"string\" ? options.amountPlaceholder : \"e.g. 52.22\" });\n      var $tracking      = create$control(\"input\", \"tracking\", $container, { type: \"hidden\", configurable: true });\n      var $redeem        = create$control(\"button\", \"redeem\", $container, {});\n      var $redeemText    = create$control(\"span\", \"redeemText\", $redeem, { text: typeof options.textRedeem === \"string\" ? options.textRedeem : \"Redeem\" });\n\n      var self = this;\n      var classInvalid = options.classInvalid === \"string\" ? options.classInvalid : \"voucherifyInvalid\";\n      var classValid = typeof options.classValid === \"string\" ? options.classValid : \"voucherifyValid\";\n      var classInvalidAnimation = options.classInvalidAnimation === \"string\" ? options.classInvalidAnimation : \"voucherifyAnimationShake\";\n      var classValidAnimation = options.classValidAnimation === \"string\" ? options.classValidAnimation : \"voucherifyAnimationTada\";\n\n      $code.on(\"keyup\", function (event) {\n        $code.toggleClass(classInvalidAnimation, false);\n      });\n\n      $amount.on(\"keyup\", function (event) {\n        $amount.toggleClass(classInvalidAnimation, false);\n      });\n\n      $redeem.on(\"click\", function (event) {\n        $tracking.val(\"\");\n\n        $redeem.toggleClass(classInvalid, false);\n        $redeem.toggleClass(classValid, false);\n\n        if (!$code.val()) {\n          $code.toggleClass(classInvalidAnimation, true)\n            .delay(1000)\n            .queue(function () {\n              $code.toggleClass(classInvalidAnimation, false);\n              $code.dequeue();\n            });\n          return;\n        }\n\n        var payload = {\n          order: {\n            amount: parseInt(parseFloat($amount.val().replace(/\\,/, \".\")) * 100)\n          }\n        };\n\n        self.redeem($code.val(), payload, function (response) {\n          if (!response || response.result !== 'SUCCESS') {\n\n            var setFieldInvalid = function ($field) {\n              $field.toggleClass(classInvalid, true);\n              $field.toggleClass(classValid, false);\n              $field.toggleClass(classInvalidAnimation, true)\n                .delay(1000)\n                .queue(function () {\n                  $field.toggleClass(classInvalidAnimation, false);\n                  $field.dequeue();\n                });\n            };\n\n            $redeem.toggleClass(classInvalid, true);\n            $redeem.toggleClass(classValid, false);\n\n            var context      = response.context || {};\n            var responseJSON = context.responseJSON || {};\n            var error_key    = responseJSON.key;\n\n            if (options.amount && (\n                error_key === INVALID_AMOUNT ||\n                error_key === INVALID_NUMBER ||\n                error_key === MISSING_AMOUNT)) {\n              setFieldInvalid($amount);\n            } else {\n              setFieldInvalid($code);\n            }\n            return;\n          }\n\n          if ($amount.val() >= 0) {\n            $amount.val(parseFloat($amount.val().replace(/\\,/, \".\")));\n          } else {\n            $amount.hide(100);\n          }\n\n          $code.toggleClass(classInvalid, false);\n          $amount.toggleClass(classInvalid, false);\n          $tracking.val(response.tracking_id || \"\");\n\n          $code.prop(\"disabled\", true);\n          $amount.prop(\"disabled\", true);\n          $redeem.prop(\"disabled\", true);\n\n          $code.toggleClass(classValid, true);\n          $amount.toggleClass(classValid, true);\n          $redeem.toggleClass(classValid, true);\n          $redeem.toggleClass(classInvalid, false);\n          $code.toggleClass(classInvalid, false);\n\n          $code.toggleClass(classValidAnimation, true);\n          $amount.toggleClass(classValidAnimation, true);\n\n          if (options && options.onRedeem && typeof options.onRedeem === \"function\") {\n            options.onRedeem(response);\n          }\n        });\n      });\n    },\n\n    renderPublish: function (selector, options) {\n      var $element = $(selector);\n      if (!$element || !$element.length) {\n        throw new Error(\"Element '\" + selector + \"' cannot be found\");\n      }\n\n      options = options || {};\n\n      if (!options.campaignName) {\n        throw new Error(\"Option campaignName is not specified\");\n      }\n\n      function contains(arr, prop) {\n        return Array.prototype.some.call(arr || [], function (field) {\n          return field.name === prop;\n        });\n      }\n\n      function containsCustomer(prop) {\n        return contains(options.customerFields, prop);\n      }\n\n      function isRequired(prop) {\n        var field = Array.prototype.find.call(options.customerFields || [], function (field) {\n          return field.name === prop;\n        });\n\n        return field && field.required || false;\n      }\n\n      function getCapitalizedName(name) {\n        return name.charAt(0).toUpperCase() + name.slice(1);\n      }\n\n      function getPropertyName(prefix, name) {\n        return prefix + getCapitalizedName(name);\n      }\n\n      function getConfigProperty(prefix, name) {\n        return options[getPropertyName(prefix, name)];\n      }\n\n      function create$control(type, name, $container, config) {\n        config = config || {};\n        var $control = null;\n        var configured$control = getConfigProperty(\"selector\", name);\n\n        if (config.configurable && configured$control) {\n          $control = $(configured$control);\n        }\n\n        if (!$control || !$control.length) {\n          $control = $(document.createElement(type));\n          $container.append($control);\n\n          for (var attribute in config) {\n            if (attribute !== \"configurable\" && config.hasOwnProperty(attribute)) {\n              $control.attr(attribute, config[attribute]);\n            }\n          }\n\n          if (type === \"input\") {\n            $control.attr(\"name\", getPropertyName(\"voucherify\", name));\n          }\n\n          if (type === \"span\" && config.text) {\n            $control.text(config.text);\n          }\n        }\n\n        $control.addClass(typeof getConfigProperty(\"class\", name) === \"string\" ? getConfigProperty(\"class\", name) : getPropertyName(\"voucherify\", name));\n        return $control;\n      }\n\n      var $container          = create$control(\"div\", \"container\", $element);\n      $container.addClass(\"wide\");\n      var $logoContainer      = create$control(\"figure\", \"logo\", $container);\n      var $logo               = create$control(\"img\", \"logo\", $logoContainer, { src: typeof options.logoSrc === \"string\" ? options.logoSrc : \"https://app.voucherify.io/images/favicon.png\" });\n\n      var $customerName       = containsCustomer(\"name\") && create$control(\"input\", \"customerName\", $container, { type: \"text\", placeholder: typeof options.customerNamePlaceholder === \"string\" ? options.customerNamePlaceholder : \"Name\" });\n      var $row1               = create$control(\"div\", \"row\", $container);\n      var $customerEmail      = containsCustomer(\"email\") && create$control(\"input\", \"customerEmail\", $row1, { type: \"email\", placeholder: typeof options.customerEmailPlaceholder === \"string\" ? options.customerEmailPlaceholder : \"Email\" });\n      var $customerPhone      = containsCustomer(\"phone\") && create$control(\"input\", \"customerPhone\", $row1, { type: \"text\", placeholder: typeof options.customerPhonePlaceholder === \"string\" ? options.customerPhonePlaceholder : \"Phone\" });\n      var $customerLine1      = containsCustomer(\"line_1\") && create$control(\"input\", \"customerLine1\", $container, { type: \"text\", placeholder: typeof options.customerLine1Placeholder === \"string\" ? options.customerLine1Placeholder : \"Address line 1\" });\n      var $customerLine2      = containsCustomer(\"line_2\") && create$control(\"input\", \"customerLine2\", $container, { type: \"text\", placeholder: typeof options.customerLine2Placeholder === \"string\" ? options.customerLine2Placeholder : \"Address line 2\" });\n      var $row3               = create$control(\"div\", \"row\", $container);\n      var $customerPostalCode = containsCustomer(\"postal_code\") && create$control(\"input\", \"customerPostalCode\", $row3, { type: \"text\", placeholder: typeof options.customerPostalCodePlaceholder === \"string\" ? options.customerPostalCodePlaceholder : \"Postal Code\" });\n      var $customerCity       = containsCustomer(\"city\") && create$control(\"input\", \"customerCity\", $row3, { type: \"text\", placeholder: typeof options.customerCityPlaceholder === \"string\" ? options.customerCityPlaceholder : \"City\" });\n      var $row4               = create$control(\"div\", \"row\", $container);\n      var $customerState      = containsCustomer(\"state\") && create$control(\"input\", \"customerState\", $row4, { type: \"text\", placeholder: typeof options.customerStatePlaceholder === \"string\" ? options.customerStatePlaceholder : \"State\" });\n      var $customerCountry    = containsCustomer(\"country\") && create$control(\"input\", \"customerCountry\", $row4, { type: \"text\", placeholder: typeof options.customerCountryPlaceholder === \"string\" ? options.customerCountryPlaceholder : \"Country\" });\n\n      var $tracking           = create$control(\"input\", \"tracking\", $container, { type: \"hidden\", configurable: true });\n\n      var $publishStatus      = create$control(\"input\", \"publishStatus\", $container, { type: \"text\" });\n\n      var $publish            = create$control(\"button\", \"publish\", $container, {});\n      var $publishText        = create$control(\"span\", \"publishText\", $publish, { text: typeof options.textPublish === \"string\" ? options.textPublish : \"Get voucher\" });\n\n      $publishStatus.prop(\"readonly\", true).hide();\n\n      var self = this;\n      var classInvalid = options.classInvalid === \"string\" ? options.classInvalid : \"voucherifyInvalid\";\n      var classValid = typeof options.classValid === \"string\" ? options.classValid : \"voucherifyValid\";\n      var classInvalidAnimation = options.classInvalidAnimation === \"string\" ? options.classInvalidAnimation : \"voucherifyAnimationShake\";\n      var classValidAnimation = options.classValidAnimation === \"string\" ? options.classValidAnimation : \"voucherifyAnimationTada\";\n\n      function error$control($control) {\n        $control.toggleClass(classInvalid, true);\n        $control.toggleClass(classValid, false);\n        $control.toggleClass(classInvalidAnimation, true)\n          .delay(1000)\n          .queue(function () {\n            $control.toggleClass(classInvalidAnimation, false);\n            $control.toggleClass(classInvalid, false);\n            $control.toggleClass(classValid, false);\n            $control.dequeue();\n          });\n      }\n\n      $publish.on(\"click\", function (event) {\n        $tracking.val(\"\");\n\n        $publish.toggleClass(classInvalid, false);\n        $publish.toggleClass(classValid, false);\n\n        var payload = {\n          customer: {}\n        };\n\n        if (containsCustomer(\"name\")) {\n          if (!$customerName.val() && isRequired(\"name\")) {\n            return error$control($customerName);\n          }\n          payload.customer[\"name\"] = $customerName.val();\n        }\n\n        if (containsCustomer(\"email\")) {\n          if (!$customerEmail.val() && isRequired(\"email\")) {\n            return error$control($customerEmail);\n          }\n          if ($customerEmail.val() && !EMAIL_PATTERN.test($customerEmail.val())) {\n            return error$control($customerEmail);\n          }\n          payload.customer[\"email\"] = $customerEmail.val();\n          payload.customer[\"source_id\"] = payload.customer[\"email\"];\n        }\n\n        if (containsCustomer(\"phone\")) {\n          if (!$customerPhone.val() && isRequired(\"phone\")) {\n            return error$control($customerPhone);\n          }\n          if ($customerPhone.val()) {\n            payload.customer[\"phone\"] = $customerPhone.val();\n          }\n        }\n\n        if (containsCustomer(\"line_1\") ||\n            containsCustomer(\"line_2\") ||\n            containsCustomer(\"postal_code\") ||\n            containsCustomer(\"city\") ||\n            containsCustomer(\"state\") ||\n            containsCustomer(\"country\")) {\n          payload.customer[\"address\"] = {};\n        }\n\n        if (containsCustomer(\"line_1\")) {\n          if (!$customerLine1.val() && isRequired(\"line_1\")) {\n            return error$control($customerLine1);\n          }\n          payload.customer[\"address\"][\"line_1\"] = $customerLine1.val();\n        }\n\n        if (containsCustomer(\"line_2\")) {\n          if (!$customerLine2.val() && isRequired(\"line_2\")) {\n            return error$control($customerLine2);\n          }\n          payload.customer[\"address\"][\"line_2\"] = $customerLine2.val();\n        }\n\n        if (containsCustomer(\"postal_code\")) {\n          if (!$customerPostalCode.val() && isRequired(\"postal_code\")) {\n            return error$control($customerPostalCode);\n          }\n          payload.customer[\"address\"][\"postal_code\"] = $customerPostalCode.val();\n        }\n\n        if (containsCustomer(\"city\")) {\n          if (!$customerCity.val() && isRequired(\"city\")) {\n            return error$control($customerCity);\n          }\n          payload.customer[\"address\"][\"city\"] = $customerCity.val();\n        }\n\n        if (containsCustomer(\"state\")) {\n          if (!$customerState.val() && isRequired(\"state\")) {\n            return error$control($customerState);\n          }\n          payload.customer[\"address\"][\"state\"] = $customerState.val();\n        }\n\n        if (containsCustomer(\"country\")) {\n          if (!$customerCountry.val() && isRequired(\"country\")) {\n            return error$control($customerCountry);\n          }\n          payload.customer[\"address\"][\"country\"] = $customerCountry.val();\n        }\n\n        self.publish(options.campaignName, payload, function (response) {\n          if (!response || !response.voucher || !response.voucher.code) {\n            var context      = response.context || {};\n            var responseJSON = context.responseJSON || {};\n            var error_key    = responseJSON.key;\n\n            error$control($publish);\n\n            if (containsCustomer(\"phone\") && error_key === INVALID_CUSTOMER_PHONE) {\n              error$control($customerPhone);\n            }\n\n            return;\n          }\n\n          $customerName && $customerName.hide();\n          $customerEmail && $customerEmail.hide();\n          $customerPhone && $customerPhone.hide();\n          $customerLine1 && $customerLine1.hide();\n          $customerLine2 && $customerLine2.hide();\n          $customerPostalCode && $customerPostalCode.hide();\n          $customerCity && $customerCity.hide();\n          $customerState && $customerState.hide();\n          $customerCountry && $customerCountry.hide();\n\n          $publishStatus\n              .toggleClass(classValidAnimation, true)\n              .val(response.voucher.code).show(100);\n\n          $tracking.val(response.tracking_id || \"\");\n\n          $publish.prop(\"disabled\", true);\n\n          $publish\n              .toggleClass(classInvalid, false)\n              .hide();\n\n          if (options && options.onPublished && typeof options.onPublished === \"function\") {\n            options.onPublished(response);\n          }\n        });\n      });\n    },\n    refreshIframes: function () {\n      window.docReady(function () {\n        console.info(\"Re-render voucherify iframes.\");\n        renderIframes();\n      });\n    }\n  };\n\n  (function (funcName, baseObj) {\n    \"use strict\";\n\n    if (!baseObj) {\n      return;\n    }\n\n    funcName = funcName || \"docReady\";\n    baseObj = baseObj || window;\n    var readyList = [];\n    var readyFired = false;\n    var readyEventHandlersInstalled = false;\n\n    function ready() {\n      if (!readyFired) {\n        readyFired = true;\n        for (var i = 0; i < readyList.length; i++) {\n          readyList[i].fn.call(window, readyList[i].ctx);\n        }\n        readyList = [];\n      }\n    }\n\n    function readyStateChange() {\n      if (document.readyState === \"complete\") {\n        ready();\n      }\n    }\n\n    baseObj[funcName] = function (callback, context) {\n      if (typeof callback !== \"function\") {\n        throw new TypeError(\"callback for docReady(fn) must be a function\");\n      }\n      if (readyFired) {\n        setTimeout(function () {\n          callback(context);\n        }, 1);\n        return;\n      } else {\n        readyList.push({ fn: callback, ctx: context });\n      }\n      if (document.readyState === \"complete\" || (!document.attachEvent && document.readyState === \"interactive\")) {\n        setTimeout(ready, 1);\n      } else if (!readyEventHandlersInstalled) {\n        if (document.addEventListener) {\n          document.addEventListener(\"DOMContentLoaded\", ready, false);\n          window.addEventListener(\"load\", ready, false);\n        } else {\n          document.attachEvent(\"onreadystatechange\", readyStateChange);\n          window.attachEvent(\"onload\", ready);\n        }\n        readyEventHandlersInstalled = true;\n      }\n    };\n  })(\"docReady\", window);\n\n  function renderIframes() {\n    var host = \"https://app.voucherify.io\";\n    var common_attributes = [\n      \"client-app-id\",\n      \"client-token\",\n\n      \"logo\",\n\n      \"widget-id\",\n      \"height\",\n\n      \"success-message\",\n      \"failure-message\"\n    ];\n\n    var customer_attributes = [\n      \"name-field\",\n      \"name-field-required\",\n      \"name-field-label\",\n\n      \"email-field\",\n      \"email-field-required\",\n      \"email-field-label\",\n\n      \"phone-field\",\n      \"phone-field-required\",\n      \"phone-field-label\",\n\n      \"address-line-1-field\",\n      \"address-line-1-field-required\",\n      \"address-line-1-field-label\",\n\n      \"address-line-2-field\",\n      \"address-line-2-field-required\",\n      \"address-line-2-field-label\",\n\n      \"city-field\",\n      \"city-field-required\",\n      \"city-field-label\",\n\n      \"postal-code-field\",\n      \"postal-code-field-required\",\n      \"postal-code-field-label\",\n\n      \"state-field\",\n      \"state-field-required\",\n      \"state-field-label\",\n\n      \"country-field\",\n      \"country-field-required\",\n      \"country-field-label\",\n\n      \"customer-metadata\"\n    ];\n\n    var consent_fields = [\n      \"consent-label\",\n      \"consent-description\",\n      \"consent-options\",\n      \"consent-options-required\",\n      \"consent-legal\",\n      \"consent-voucherify-note-visible\"\n    ];\n\n    var iframes_widgets = {\n      \"voucher-redeem\": {\n        \"path\": \"/widgets/redeem\",\n        \"defaults\": {\n          \"height\": \"480px\"\n        },\n        \"attributes\": [\n          \"metadata\",\n          \"redemption-metadata\",\n\n          \"metadata-fields\",\n\n          \"code\",\n\n          \"code-field\",\n          \"code-field-required\",\n          \"code-field-label\",\n\n          \"amount-field\",\n          \"amount-field-required\",\n          \"amount-field-label\",\n\n          \"button-label\"\n        ].concat(consent_fields)\n      },\n      \"get-voucher\": {\n        \"path\": \"/widgets/publish\",\n        \"defaults\": {\n          \"height\": \"430px\"\n        },\n        \"attributes\": [\n          \"campaign\",\n\n          \"metadata\",\n          \"source\",\n\n          \"button-label\"\n        ]\n      },\n      \"subscribe\": {\n        \"path\": \"/widgets/subscribe\",\n        \"defaults\": {\n          \"height\": \"220px\"\n        },\n        \"attributes\": [\n          \"metadata\",\n          \"source\",\n\n          \"subscribe-label\"\n        ].concat(consent_fields)\n      }\n    };\n\n    var helpers = {\n      bind: function (element, name, callback) {\n        if (element.addEventListener) {\n          return element.addEventListener(name, callback, false);\n        } else {\n          return element.attachEvent(\"on\" + name, callback);\n        }\n      },\n      readOptions: function (element, allowed_options, defaults) {\n        return Array.prototype.reduce.call(allowed_options, function (options, allowed_option) {\n          var option_value = element.getAttribute(\"data-\" + allowed_option);\n\n          if (option_value) {\n            options[allowed_option] = option_value;\n          } else if (defaults[allowed_option]) { // check if the default value is provided\n            options[allowed_option] = defaults[allowed_option];\n          }\n\n          return options;\n        }, {});\n      },\n      encodeOptions: function (options) {\n        var query_parameters = [];\n\n        Object.keys(options).forEach(function (option_key) {\n          query_parameters.push(\"[options][\" + option_key + \"]=\" + encodeURIComponent(options[option_key]));\n        });\n\n        return \"?\" + query_parameters.join(\"&\");\n      }\n    };\n\n\n    function RenderIframe(element, options) {\n      var self = this;\n\n      self._element = element;\n\n      self._path = options.path;\n\n      self._options = helpers.readOptions(self._element, common_attributes.concat(customer_attributes).concat(options.attributes), options.defaults);\n\n      self._iframe = null;\n\n      return this.renderIframe();\n    }\n\n    RenderIframe.prototype.renderIframe = function () {\n      var self = this;\n\n      if (self._iframe) {\n        return self;\n      }\n\n      // -- set custom height or fallback\n      var widget_height = self._options.height;\n      // -- remove custom height from options to prevent before sending it\n      self._options.height = undefined;\n\n      var css_props = [\n        \"width:400px;\",\n        \"height:\" + widget_height + \";\",\n        \"background: transparent;\",\n        \"border: 0px none transparent;\",\n        \"overflow-x: hidden;\",\n        \"overflow-y: auto;\",\n        \"visibility: hidden;\",\n        \"margin: 0;\",\n        \"padding: 0;\",\n        \"-webkit-tap-highlight-color: transparent;\",\n        \"-webkit-touch-callout: none;\"\n      ];\n\n      self._iframe = document.createElement(\"iframe\");\n      self._iframe.setAttribute(\"frameBorder\", \"0\");\n      self._iframe.setAttribute(\"allowtransparency\", \"true\");\n      self._iframe.style.cssText = css_props.join(\"\\n\");\n\n      helpers.bind(self._iframe, \"load\", function () {\n        return self._iframe.style.visibility = \"visible\";\n      });\n\n      self._iframe.src = host + self._path + helpers.encodeOptions(self._options);\n\n      self._element.appendChild(self._iframe);\n\n      return self;\n    };\n\n    var widgets = [];\n\n    Object.keys(iframes_widgets).forEach(function (widget_name) {\n      var elements = window.document.querySelectorAll(\".voucherify-\" + widget_name);\n\n      Array.prototype.forEach.call(elements, function (element) {\n        widgets.push(new RenderIframe(element, iframes_widgets[widget_name]));\n      });\n    });\n\n    return widgets;\n  }\n\n  if (window) {\n    window.docReady(function () {\n      console.info(\"Document ready. Render voucherify iframes.\");\n      renderIframes();\n    });\n  }\n\n\n  if (typeof module !== \"undefined\" && module.exports) {\n    module.exports = voucherify;\n  }\n\n  return voucherify;\n}(window, window.document, window.jQuery));\n"],"sourceRoot":"/source/"}